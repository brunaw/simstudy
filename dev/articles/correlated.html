<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Correlated Data • simstudy</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Correlated Data">
<meta property="og:description" content="simstudy">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simstudy</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.2.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/simstudy.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/clustered.html">Clustered Data</a>
    </li>
    <li>
      <a href="../articles/correlated.html">Correlated Data</a>
    </li>
    <li>
      <a href="../articles/double_dot_extension.html">Dynamic Data Definition</a>
    </li>
    <li>
      <a href="../articles/longitudinal.html">Longitudinal Data</a>
    </li>
    <li>
      <a href="../articles/missing.html">Missing Data</a>
    </li>
    <li>
      <a href="../articles/ordinal.html">Ordinal Categorical Data</a>
    </li>
    <li>
      <a href="../articles/spline.html">Spline Data</a>
    </li>
    <li>
      <a href="../articles/survival.html">Survival Data</a>
    </li>
    <li>
      <a href="../articles/treat_and_exposure.html">Treatment and Exposure</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kgoldfeld/simstudy/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="correlated_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Correlated Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kgoldfeld/simstudy/blob/master/vignettes/correlated.Rmd"><code>vignettes/correlated.Rmd</code></a></small>
      <div class="hidden name"><code>correlated.Rmd</code></div>

    </div>

    
    
<div id="correlated-data" class="section level2">
<h2 class="hasAnchor">
<a href="#correlated-data" class="anchor"></a>Correlated data</h2>
<p>Sometimes it is desirable to simulate correlated data from a correlation matrix directly. For example, a simulation might require two random effects (e.g. a random intercept and a random slope). Correlated data like this could be generated using the <code>defData</code> functionality, but it may be more natural to do this with <code>genCorData</code> or <code>addCorData</code>. Currently, simstudy can only generate multivariate normal using these functions. (In the future, additional distributions will be available.)</p>
<p><code>genCorData</code> requires the user to specify a mean vector <code>mu</code>, a single standard deviation or a vector of standard deviations <code>sigma</code>, and either a correlation matrix <code>corMatrix</code> or a correlation coefficient <code>rho</code> and a correlation structure <code>corsrt</code>. It is easy to see how this can be used from a few different examples.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co"># specifying a specific correlation matrix C</span>
<span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.7</span>, <span class="fl">0.2</span>, <span class="fl">0.7</span>, <span class="fl">1</span>, <span class="fl">0.8</span>, <span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">C</span></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]  1.0  0.7  0.2
## [2,]  0.7  1.0  0.8
## [3,]  0.2  0.8  1.0</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="co"># generate 3 correlated variables with different location and scale for each</span>
<span class="co"># field</span>
<span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genCorData.html">genCorData</a></span><span class="op">(</span><span class="fl">1000</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">12</span>, <span class="fl">3</span><span class="op">)</span>, sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, corMatrix <span class="op">=</span> <span class="va">C</span><span class="op">)</span>
<span class="va">dt</span></pre></div>
<pre><code>##         id       V1       V2          V3
##    1:    1 4.824790 10.02518 -2.93145440
##    2:    2 3.992533 11.86522  0.08628594
##    3:    3 3.857890 14.07002  7.72106771
##    4:    4 4.007582 10.67103  1.72168465
##    5:    5 4.633439 14.79294  8.38300957
##   ---                                   
##  996:  996 2.703101  8.28239 -1.39322947
##  997:  997 4.370201 13.44972  3.70084402
##  998:  998 3.789381 10.66565  1.02502141
##  999:  999 4.350387 10.16406  0.37603653
## 1000: 1000 4.191963 13.03829  5.76996570</code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="co"># estimate correlation matrix</span>
<span class="va">dt</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">V1</span>, <span class="va">V2</span>, <span class="va">V3</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span></pre></div>
<pre><code>##     V1  V2  V3
## V1 1.0 0.7 0.2
## V2 0.7 1.0 0.8
## V3 0.2 0.8 1.0</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="co"># estimate standard deviation</span>
<span class="va">dt</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">V1</span>, <span class="va">V2</span>, <span class="va">V3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span></pre></div>
<pre><code>## V1 V2 V3 
##  1  2  3</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="co"># generate 3 correlated variables with different location but same standard</span>
<span class="co"># deviation and compound symmetry (cs) correlation matrix with correlation</span>
<span class="co"># coefficient = 0.4.  Other correlation matrix structures are 'independent'</span>
<span class="co"># ('ind') and 'auto-regressive' ('ar1').</span>

<span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genCorData.html">genCorData</a></span><span class="op">(</span><span class="fl">1000</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">12</span>, <span class="fl">3</span><span class="op">)</span>, sigma <span class="op">=</span> <span class="fl">3</span>, rho <span class="op">=</span> <span class="fl">0.4</span>, corstr <span class="op">=</span> <span class="st">"cs"</span>, cnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x0"</span>, 
    <span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span><span class="op">)</span>
<span class="va">dt</span></pre></div>
<pre><code>##         id         x0        x1         x2
##    1:    1  0.1294654 11.586968  5.0100484
##    2:    2  0.3919537 10.935491  3.4822523
##    3:    3 -3.3307052  5.525160 -0.7719059
##    4:    4  5.1440028 12.767748  0.8864212
##    5:    5 -1.8339648  8.044376  5.6386232
##   ---                                     
##  996:  996  1.5263459 11.317897  4.9164720
##  997:  997  3.9354139  9.373760 -2.0196055
##  998:  998  0.4794405  7.158529  1.9955359
##  999:  999  5.8978021 15.725165  5.8706721
## 1000: 1000  7.4117781 10.877113  1.4301597</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="co"># estimate correlation matrix</span>
<span class="va">dt</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">x0</span>, <span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span></pre></div>
<pre><code>##     x0  x1  x2
## x0 1.0 0.4 0.4
## x1 0.4 1.0 0.4
## x2 0.4 0.4 1.0</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="co"># estimate standard deviation</span>
<span class="va">dt</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">x0</span>, <span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span></pre></div>
<pre><code>##  x0  x1  x2 
## 3.1 2.9 3.0</code></pre>
<p>The new data generated by <code>genCorData</code> can be merged with an existing data set. Alternatively, <code>addCorData</code> will do this directly:</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="co"># define and generate the original data set</span>
<span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span>varname <span class="op">=</span> <span class="st">"x"</span>, dist <span class="op">=</span> <span class="st">"normal"</span>, formula <span class="op">=</span> <span class="fl">0</span>, variance <span class="op">=</span> <span class="fl">1</span>, id <span class="op">=</span> <span class="st">"cid"</span><span class="op">)</span>
<span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genData.html">genData</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="va">def</span><span class="op">)</span>

<span class="co"># add new correlate fields a0 and a1 to 'dt'</span>
<span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addCorData.html">addCorData</a></span><span class="op">(</span><span class="va">dt</span>, idname <span class="op">=</span> <span class="st">"cid"</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.2</span><span class="op">)</span>, rho <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span>, 
    corstr <span class="op">=</span> <span class="st">"cs"</span>, cnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a0"</span>, <span class="st">"a1"</span><span class="op">)</span><span class="op">)</span>

<span class="va">dt</span></pre></div>
<pre><code>##        cid           x         a0           a1
##    1:    1  0.74031704  0.6524165  0.293292456
##    2:    2 -0.49981224 -0.6516655  0.089576070
##    3:    3  0.09938294  1.8543466  0.096873977
##    4:    4 -0.14670929 -0.1106558 -0.008911557
##    5:    5  0.62840989  3.1904863 -0.014918695
##   ---                                         
##  996:  996 -0.70902856 -0.8639502  0.067750649
##  997:  997 -0.95300954  2.5977515 -0.059819068
##  998:  998 -0.72851496 -1.4132500 -0.122280623
##  999:  999 -0.12104557 -1.3053640  0.149403367
## 1000: 1000  1.47966479 -1.9282698 -0.058318597</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="co"># estimate correlation matrix</span>
<span class="va">dt</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">a0</span>, <span class="va">a1</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span></pre></div>
<pre><code>##      a0   a1
## a0  1.0 -0.2
## a1 -0.2  1.0</code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="co"># estimate standard deviation</span>
<span class="va">dt</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">a0</span>, <span class="va">a1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span></pre></div>
<pre><code>##  a0  a1 
## 2.0 0.2</code></pre>
<div id="correlated-data-additional-distributions" class="section level3">
<h3 class="hasAnchor">
<a href="#correlated-data-additional-distributions" class="anchor"></a>Correlated data: additional distributions</h3>
<p>Two additional functions facilitate the generation of correlated data from <em>binomial</em>, <em>poisson</em>, <em>gamma</em>, and <em>uniform</em> distributions: <code>genCorGen</code> and <code>addCorGen</code>.</p>
<p><code>genCorGen</code> is an extension of <code>genCorData</code>. In the first example, we are generating data from a multivariate Poisson distribution. We start by specifying the mean of the Poisson distribution for each new variable, and then we specify the correlation structure, just as we did with the normal distribution.</p>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">10</span>, <span class="fl">12</span><span class="op">)</span> <span class="co"># lambda for each new variable</span>

<span class="va">dx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genCorGen.html">genCorGen</a></span><span class="op">(</span><span class="fl">1000</span>, nvars <span class="op">=</span> <span class="fl">3</span>, params1 <span class="op">=</span> <span class="va">l</span>, dist <span class="op">=</span> <span class="st">"poisson"</span>, rho <span class="op">=</span> <span class="fl">.3</span>, corstr <span class="op">=</span> <span class="st">"cs"</span>, wide <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">dx</span></pre></div>
<pre><code>##         id V1 V2 V3
##    1:    1  4  5 15
##    2:    2 10 11 13
##    3:    3 11  9 16
##    4:    4  8  3  8
##    5:    5  9  6 10
##   ---              
##  996:  996  8  9 15
##  997:  997  7  7 13
##  998:  998  7  8 10
##  999:  999  5 13 12
## 1000: 1000 10 10 17</code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">dx</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">V1</span>, <span class="va">V2</span>, <span class="va">V3</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></pre></div>
<pre><code>##      V1   V2   V3
## V1 1.00 0.28 0.28
## V2 0.28 1.00 0.28
## V3 0.28 0.28 1.00</code></pre>
<p>We can also generate correlated binary data by specifying the probabilities:</p>
<div class="sourceCode" id="cb25"><pre class="downlit">
<span class="fu"><a href="../reference/genCorGen.html">genCorGen</a></span><span class="op">(</span><span class="fl">1000</span>, nvars <span class="op">=</span> <span class="fl">3</span>, params1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.3</span>, <span class="fl">.5</span>, <span class="fl">.7</span><span class="op">)</span>, dist <span class="op">=</span> <span class="st">"binary"</span>, rho <span class="op">=</span> <span class="fl">.8</span>, corstr <span class="op">=</span> <span class="st">"cs"</span>, wide <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></pre></div>
<pre><code>##         id V1 V2 V3
##    1:    1  1  1  1
##    2:    2  0  0  1
##    3:    3  0  1  1
##    4:    4  1  1  1
##    5:    5  0  1  1
##   ---              
##  996:  996  0  0  1
##  997:  997  0  0  1
##  998:  998  0  0  1
##  999:  999  0  0  0
## 1000: 1000  1  1  1</code></pre>
<p>The gamma distribution requires two parameters - the mean and dispersion. (These are converted into shape and rate parameters more commonly used.)</p>
<div class="sourceCode" id="cb27"><pre class="downlit">
<span class="va">dx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genCorGen.html">genCorGen</a></span><span class="op">(</span><span class="fl">1000</span>, nvars <span class="op">=</span> <span class="fl">3</span>, params1 <span class="op">=</span> <span class="va">l</span>, params2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, dist <span class="op">=</span> <span class="st">"gamma"</span>, rho <span class="op">=</span> <span class="fl">.7</span>, corstr <span class="op">=</span> <span class="st">"cs"</span>, wide <span class="op">=</span> <span class="cn">TRUE</span>, cnames<span class="op">=</span><span class="st">"a, b, c"</span><span class="op">)</span>
<span class="va">dx</span></pre></div>
<pre><code>##         id         a         b         c
##    1:    1 12.243601  2.954601  3.280114
##    2:    2  2.321686  1.782473  2.201376
##    3:    3  4.204570 16.443247 10.912331
##    4:    4  2.774905  8.041185  1.263056
##    5:    5  3.831571  4.482582 10.793395
##   ---                                   
##  996:  996  2.365157  1.538805  2.862979
##  997:  997 30.505385 50.980973 56.219998
##  998:  998  4.296130  2.927686  9.820149
##  999:  999  3.071881  9.143758 11.991755
## 1000: 1000  9.024261 20.983690 31.937752</code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">dx</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">c</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></pre></div>
<pre><code>##      a    b    c
## a 1.00 0.66 0.65
## b 0.66 1.00 0.68
## c 0.65 0.68 1.00</code></pre>
<p>These data sets can be generated in either <em>wide</em> or <em>long</em> form. So far, we have generated <em>wide</em> form data, where there is one row per unique id. Now, we will generate data using the <em>long</em> form, where the correlated data are on different rows, so that there are repeated measurements for each id. An id will have multiple records (i.e. one id will appear on multiple rows):</p>
<div class="sourceCode" id="cb31"><pre class="downlit">
<span class="va">dx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genCorGen.html">genCorGen</a></span><span class="op">(</span><span class="fl">1000</span>, nvars <span class="op">=</span> <span class="fl">3</span>, params1 <span class="op">=</span> <span class="va">l</span>, params2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, dist <span class="op">=</span> <span class="st">"gamma"</span>, rho <span class="op">=</span> <span class="fl">.7</span>, corstr <span class="op">=</span> <span class="st">"cs"</span>, wide <span class="op">=</span> <span class="cn">FALSE</span>, cnames<span class="op">=</span><span class="st">"NewCol"</span><span class="op">)</span>
<span class="va">dx</span></pre></div>
<pre><code>##         id period     NewCol
##    1:    1      0  4.6235265
##    2:    1      1  6.5235593
##    3:    1      2  9.1540488
##    4:    2      0  0.9519749
##    5:    2      1  5.9006155
##   ---                       
## 2996:  999      1  0.1188597
## 2997:  999      2  0.9155037
## 2998: 1000      0 14.5118149
## 2999: 1000      1 42.9993299
## 3000: 1000      2 10.5902658</code></pre>
<p><code>addCorGen</code> allows us to create correlated data from an existing data set, as one can already do using <code>addCorData</code>. In the case of <code>addCorGen</code>, the parameter(s) used to define the distribution are created as a field (or fields) in the dataset. The correlated data are added to the existing data set. In the example below, we are going to generate three sets (poisson, binary, and gamma) of correlated data with means that are a function of the variable <code>xbase</code>, which varies by id.</p>
<p>First we define the data and generate a data set:</p>
<div class="sourceCode" id="cb33"><pre class="downlit">
<span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span>varname <span class="op">=</span> <span class="st">"xbase"</span>, formula <span class="op">=</span> <span class="fl">5</span>, variance <span class="op">=</span> <span class="fl">.2</span>, dist <span class="op">=</span> <span class="st">"gamma"</span>, id <span class="op">=</span> <span class="st">"cid"</span><span class="op">)</span>
<span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">def</span>, varname <span class="op">=</span> <span class="st">"lambda"</span>, formula <span class="op">=</span> <span class="st">".5 + .1*xbase"</span>, dist<span class="op">=</span><span class="st">"nonrandom"</span>, link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>
<span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">def</span>, varname <span class="op">=</span> <span class="st">"p"</span>, formula <span class="op">=</span> <span class="st">"-2 + .3*xbase"</span>, dist<span class="op">=</span><span class="st">"nonrandom"</span>, link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>
<span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">def</span>, varname <span class="op">=</span> <span class="st">"gammaMu"</span>, formula <span class="op">=</span> <span class="st">".5 + .2*xbase"</span>, dist<span class="op">=</span><span class="st">"nonrandom"</span>, link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>
<span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">def</span>, varname <span class="op">=</span> <span class="st">"gammaDis"</span>, formula <span class="op">=</span> <span class="fl">1</span>, dist<span class="op">=</span><span class="st">"nonrandom"</span><span class="op">)</span>

<span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genData.html">genData</a></span><span class="op">(</span><span class="fl">10000</span>, <span class="va">def</span><span class="op">)</span>
<span class="va">dt</span></pre></div>
<pre><code>##          cid    xbase   lambda         p  gammaMu gammaDis
##     1:     1 4.948710 2.704375 0.3739315 4.435951        1
##     2:     2 7.196037 3.385846 0.5396196 6.953238        1
##     3:     3 8.576263 3.886956 0.6394272 9.163724        1
##     4:     4 6.084478 3.029652 0.4564465 5.567218        1
##     5:     5 5.941364 2.986602 0.4458159 5.410129        1
##    ---                                                    
##  9996:  9996 3.840093 2.420585 0.2998585 3.553804        1
##  9997:  9997 3.785480 2.407402 0.2964301 3.515199        1
##  9998:  9998 4.060283 2.474475 0.3139073 3.713804        1
##  9999:  9999 2.962556 2.217223 0.2476410 2.981752        1
## 10000: 10000 8.558488 3.880053 0.6381968 9.131204        1</code></pre>
<p>The Poisson distribution has a single parameter, lambda:</p>
<div class="sourceCode" id="cb35"><pre class="downlit">
<span class="va">dtX1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addCorGen.html">addCorGen</a></span><span class="op">(</span>dtOld <span class="op">=</span> <span class="va">dt</span>, idvar <span class="op">=</span> <span class="st">"cid"</span>, nvars <span class="op">=</span> <span class="fl">3</span>, rho <span class="op">=</span> <span class="fl">.1</span>, corstr <span class="op">=</span> <span class="st">"cs"</span>,
                    dist <span class="op">=</span> <span class="st">"poisson"</span>, param1 <span class="op">=</span> <span class="st">"lambda"</span>, cnames <span class="op">=</span> <span class="st">"a, b, c"</span><span class="op">)</span>
<span class="va">dtX1</span></pre></div>
<pre><code>##          cid    xbase   lambda         p  gammaMu gammaDis a b c
##     1:     1 4.948710 2.704375 0.3739315 4.435951        1 4 5 4
##     2:     2 7.196037 3.385846 0.5396196 6.953238        1 2 4 4
##     3:     3 8.576263 3.886956 0.6394272 9.163724        1 3 7 5
##     4:     4 6.084478 3.029652 0.4564465 5.567218        1 2 0 4
##     5:     5 5.941364 2.986602 0.4458159 5.410129        1 2 3 2
##    ---                                                          
##  9996:  9996 3.840093 2.420585 0.2998585 3.553804        1 6 3 2
##  9997:  9997 3.785480 2.407402 0.2964301 3.515199        1 2 2 3
##  9998:  9998 4.060283 2.474475 0.3139073 3.713804        1 2 1 2
##  9999:  9999 2.962556 2.217223 0.2476410 2.981752        1 2 3 3
## 10000: 10000 8.558488 3.880053 0.6381968 9.131204        1 4 4 4</code></pre>
<p>The Bernoulli (binary) distribution has a single parameter, p:</p>
<div class="sourceCode" id="cb37"><pre class="downlit">
<span class="va">dtX2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addCorGen.html">addCorGen</a></span><span class="op">(</span>dtOld <span class="op">=</span> <span class="va">dt</span>, idvar <span class="op">=</span> <span class="st">"cid"</span>, nvars <span class="op">=</span> <span class="fl">4</span>, rho <span class="op">=</span> <span class="fl">.4</span>, corstr <span class="op">=</span> <span class="st">"ar1"</span>,
                    dist <span class="op">=</span> <span class="st">"binary"</span>, param1 <span class="op">=</span> <span class="st">"p"</span><span class="op">)</span>
<span class="va">dtX2</span></pre></div>
<pre><code>##          cid    xbase   lambda         p  gammaMu gammaDis V1 V2 V3 V4
##     1:     1 4.948710 2.704375 0.3739315 4.435951        1  1  0  1  0
##     2:     2 7.196037 3.385846 0.5396196 6.953238        1  1  0  1  1
##     3:     3 8.576263 3.886956 0.6394272 9.163724        1  0  0  0  1
##     4:     4 6.084478 3.029652 0.4564465 5.567218        1  0  0  1  0
##     5:     5 5.941364 2.986602 0.4458159 5.410129        1  0  0  1  1
##    ---                                                                
##  9996:  9996 3.840093 2.420585 0.2998585 3.553804        1  1  1  0  1
##  9997:  9997 3.785480 2.407402 0.2964301 3.515199        1  1  1  1  0
##  9998:  9998 4.060283 2.474475 0.3139073 3.713804        1  1  1  1  0
##  9999:  9999 2.962556 2.217223 0.2476410 2.981752        1  0  1  0  0
## 10000: 10000 8.558488 3.880053 0.6381968 9.131204        1  1  0  1  0</code></pre>
<p>The Gamma distribution has two parameters - in <code>simstudy</code> the mean and dispersion are specified:</p>
<div class="sourceCode" id="cb39"><pre class="downlit">
<span class="va">dtX3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addCorGen.html">addCorGen</a></span><span class="op">(</span>dtOld <span class="op">=</span> <span class="va">dt</span>, idvar <span class="op">=</span> <span class="st">"cid"</span>, nvars <span class="op">=</span> <span class="fl">4</span>, rho <span class="op">=</span> <span class="fl">.4</span>, corstr <span class="op">=</span> <span class="st">"cs"</span>,
                  dist <span class="op">=</span> <span class="st">"gamma"</span>, param1 <span class="op">=</span> <span class="st">"gammaMu"</span>, param2 <span class="op">=</span> <span class="st">"gammaDis"</span><span class="op">)</span>
<span class="va">dtX3</span></pre></div>
<pre><code>##          cid    xbase   lambda         p  gammaMu gammaDis         V1       V2
##     1:     1 4.948710 2.704375 0.3739315 4.435951        1  3.5371372 5.634134
##     2:     2 7.196037 3.385846 0.5396196 6.953238        1 11.3467323 1.137955
##     3:     3 8.576263 3.886956 0.6394272 9.163724        1  3.4833052 6.036109
##     4:     4 6.084478 3.029652 0.4564465 5.567218        1  0.6163427 1.583878
##     5:     5 5.941364 2.986602 0.4458159 5.410129        1  2.7318939 5.134660
##    ---                                                                        
##  9996:  9996 3.840093 2.420585 0.2998585 3.553804        1  1.6677265 2.582673
##  9997:  9997 3.785480 2.407402 0.2964301 3.515199        1  2.4653864 5.742151
##  9998:  9998 4.060283 2.474475 0.3139073 3.713804        1  9.4828780 5.387644
##  9999:  9999 2.962556 2.217223 0.2476410 2.981752        1  7.6601818 7.624459
## 10000: 10000 8.558488 3.880053 0.6381968 9.131204        1 22.8801215 4.842905
##                V3         V4
##     1:  0.7671990  2.1691653
##     2: 13.5891299  0.3712258
##     3: 12.4041864 10.6410968
##     4: 18.2965652 10.9842783
##     5:  0.4275551  1.3381806
##    ---                      
##  9996:  0.4313938  1.3646603
##  9997:  2.4863484  4.0006760
##  9998:  4.4758155  5.0892394
##  9999:  0.1834469  0.8668061
## 10000:  6.1511611 17.5701548</code></pre>
<p>If we have data in <em>long</em> form (e.g. longitudinal data), the function will recognize the structure:</p>
<div class="sourceCode" id="cb41"><pre class="downlit">
<span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span>varname <span class="op">=</span> <span class="st">"xbase"</span>, formula <span class="op">=</span> <span class="fl">5</span>, variance <span class="op">=</span> <span class="fl">.4</span>, dist <span class="op">=</span> <span class="st">"gamma"</span>, id <span class="op">=</span> <span class="st">"cid"</span><span class="op">)</span>
<span class="va">def</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defData.html">defData</a></span><span class="op">(</span><span class="va">def</span>, <span class="st">"nperiods"</span>, formula <span class="op">=</span> <span class="fl">3</span>, dist <span class="op">=</span> <span class="st">"noZeroPoisson"</span><span class="op">)</span>

<span class="va">def2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defDataAdd.html">defDataAdd</a></span><span class="op">(</span>varname <span class="op">=</span> <span class="st">"lambda"</span>, formula <span class="op">=</span> <span class="st">".5+.5*period + .1*xbase"</span>, dist<span class="op">=</span><span class="st">"nonrandom"</span>, link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>

<span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genData.html">genData</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="va">def</span><span class="op">)</span>

<span class="va">dtLong</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addPeriods.html">addPeriods</a></span><span class="op">(</span><span class="va">dt</span>, idvars <span class="op">=</span> <span class="st">"cid"</span>, nPeriods <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">dtLong</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addColumns.html">addColumns</a></span><span class="op">(</span><span class="va">def2</span>, <span class="va">dtLong</span><span class="op">)</span>

<span class="va">dtLong</span></pre></div>
<pre><code>##        cid period      xbase nperiods timeID    lambda
##    1:    1      0  3.0388117        3      1  2.234195
##    2:    1      1  3.0388117        3      2  3.683566
##    3:    1      2  3.0388117        3      3  6.073173
##    4:    2      0  2.6269594        6      4  2.144049
##    5:    2      1  2.6269594        6      5  3.534939
##   ---                                                 
## 2996:  999      1  0.9720069        2   2996  2.995768
## 2997:  999      2  0.9720069        2   2997  4.939187
## 2998: 1000      0 10.9017294        3   2998  4.904597
## 2999: 1000      1 10.9017294        3   2999  8.086314
## 3000: 1000      2 10.9017294        3   3000 13.332077</code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit">
<span class="co">### Generate the data </span>

<span class="va">dtX3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addCorGen.html">addCorGen</a></span><span class="op">(</span>dtOld <span class="op">=</span> <span class="va">dtLong</span>, idvar <span class="op">=</span> <span class="st">"cid"</span>, nvars <span class="op">=</span> <span class="fl">3</span>, rho <span class="op">=</span> <span class="fl">.6</span>, corstr <span class="op">=</span> <span class="st">"cs"</span>,
                  dist <span class="op">=</span> <span class="st">"poisson"</span>, param1 <span class="op">=</span> <span class="st">"lambda"</span>, cnames <span class="op">=</span> <span class="st">"NewPois"</span><span class="op">)</span>
<span class="va">dtX3</span></pre></div>
<pre><code>##        cid period      xbase nperiods timeID    lambda NewPois
##    1:    1      0  3.0388117        3      1  2.234195       1
##    2:    1      1  3.0388117        3      2  3.683566       3
##    3:    1      2  3.0388117        3      3  6.073173       6
##    4:    2      0  2.6269594        6      4  2.144049       3
##    5:    2      1  2.6269594        6      5  3.534939       6
##   ---                                                         
## 2996:  999      1  0.9720069        2   2996  2.995768       2
## 2997:  999      2  0.9720069        2   2997  4.939187       4
## 2998: 1000      0 10.9017294        3   2998  4.904597       8
## 2999: 1000      1 10.9017294        3   2999  8.086314      11
## 3000: 1000      2 10.9017294        3   3000 13.332077      15</code></pre>
<p>We can fit a generalized estimating equation (GEE) model and examine the coefficients and the working correlation matrix. They match closely to the data generating parameters:</p>
<div class="sourceCode" id="cb45"><pre class="downlit">
<span class="va">geefit</span> <span class="op">&lt;-</span> <span class="fu">gee</span><span class="op">(</span><span class="va">NewPois</span> <span class="op">~</span> <span class="va">period</span> <span class="op">+</span> <span class="va">xbase</span>, data <span class="op">=</span> <span class="va">dtX3</span>, id <span class="op">=</span> <span class="va">cid</span>, family <span class="op">=</span> <span class="va">poisson</span>, corstr <span class="op">=</span> <span class="st">"exchangeable"</span><span class="op">)</span></pre></div>
<pre><code>## Beginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27</code></pre>
<pre><code>## running glm to get initial regression estimate</code></pre>
<pre><code>## (Intercept)      period       xbase 
##   0.4893572   0.5090381   0.1007322</code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">geefit</span><span class="op">)</span><span class="op">$</span><span class="va">working.correlation</span>, <span class="fl">2</span><span class="op">)</span></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,] 1.00 0.58 0.58
## [2,] 0.58 1.00 0.58
## [3,] 0.58 0.58 1.00</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.rdatagen.net/">Keith Goldfeld</a>, Jacob Wujciak-Jens.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
